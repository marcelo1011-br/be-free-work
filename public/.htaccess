# --------------------------------------------
# Be Free Tours — .htaccess (Otimizado & Corrigido)
# --------------------------------------------

RewriteEngine On

# --- 1) FORCE HTTPS + CANONICAL HOST (non-www) ---
RewriteCond %{HTTPS} off [OR]
RewriteCond %{HTTP_HOST} !^befreetours\.com\.br$ [NC]
RewriteRule ^ https://befreetours.com.br%{REQUEST_URI} [R=301,L]

# --- 2) LANGUAGE REDIRECT (ROOT ONLY) ---
<IfModule mod_headers.c>
  SetEnvIf Request_URI "^/$" IS_ROOT=1
  Header merge Vary "Accept-Language" env=IS_ROOT
</IfModule>

RewriteCond %{REQUEST_URI} ^/$
RewriteCond %{HTTP:Accept-Language} ^pt [NC]
RewriteRule ^$ /pt-br/ [R=302,L]

RewriteCond %{REQUEST_URI} ^/$
RewriteCond %{HTTP:Accept-Language} ^es [NC]
RewriteRule ^$ /es/ [R=302,L]

RewriteCond %{REQUEST_URI} ^/$
RewriteRule ^$ /en/ [R=302,L]

# --- 3) OPTIONAL URL NORMALIZATION ---
RewriteRule ^(.*)/index\.html$ /$1/ [R=301,L]

# --------------------------------------------
# 4) REDIRECTS (SEO PRESERVATION)
# --------------------------------------------
# (Manti todos os seus redirecionamentos de tours e blog aqui...)
Redirect 301 /home/private-tours-rio/ /en/private-tours
Redirect 301 /home/private-tours-rio/rio-city-tours/ /en/private-tours
Redirect 301 /home/private-tours-rio/rio-day-trips/ /en/private-tours
Redirect 301 /home/private-tours-rio/walking-tours/ /en/private-tours
Redirect 301 /home/private-tours-rio/custom-rio-tours/design-your-tour/ /en/private-tours/custom-tour

Redirect 301 /home/private-tours-rio/rio-city-tours/christ-redeemer-sugarloaf-tour/ /en/private-tours/essential-rio
Redirect 301 /home/private-tours-rio/rio-city-tours/half-day-highlights/ /en/private-tours/rio-express
Redirect 301 /home/private-tours-rio/rio-day-trips/ilha-grande-speedboat/ /en/private-tours/island-escape-ilha-grande
Redirect 301 /home/private-tours-rio/rio-day-trips/petropolis-imperial-city/ /en/private-tours/petropolis-imperial
Redirect 301 /home/private-tours-rio/walking-tours/city-center-historic-walk/ /en/private-tours/downtown-rio-walking

# [EN]
Redirect 301 /en/private-tours/unforgettable-rio /en/private-tours/essential-rio
Redirect 301 /en/private-tours/rio-flash /en/private-tours/rio-express
Redirect 301 /en/private-tours/sunrise-sugarloaf /en/private-tours/first-light-sunrise
Redirect 301 /en/private-tours/sunset-magic /en/private-tours/golden-hour-rio
Redirect 301 /en/private-tours/sunset-roxy /en/private-tours/sunset-culture-roxy
Redirect 301 /en/private-tours/ilha-grande /en/private-tours/island-escape-ilha-grande
Redirect 301 /en/private-tours/buzios /en/private-tours/buzios-riviera
Redirect 301 /en/private-tours/petropolis /en/private-tours/petropolis-imperial
Redirect 301 /en/private-tours/sky-high /en/private-tours/tijuca-rainforest
Redirect 301 /en/private-tours/niteroi /en/private-tours/niteroi-mac-museum
Redirect 301 /en/private-tours/future-visions /en/private-tours/modern-rio-museum-tomorrow
Redirect 301 /en/private-tours/historical-walking /en/private-tours/downtown-rio-walking

# [ES]
Redirect 301 /es/tours-privados/rio-inolvidable /es/tours-privados/essential-rio
Redirect 301 /es/tours-privados/rio-flash /es/tours-privados/rio-express
Redirect 301 /es/tours-privados/amanecer-pao-acucar /es/tours-privados/amanecer-rio
Redirect 301 /es/tours-privados/magia-atardecer /es/tours-privados/hora-dorada-rio
Redirect 301 /es/tours-privados/atardecer-roxy /es/tours-privados/atardecer-cultura-roxy
Redirect 301 /es/tours-privados/ilha-grande /es/tours-privados/island-escape-ilha-grande
Redirect 301 /es/tours-privados/buzios /es/tours-privados/buzios-riviera
Redirect 301 /es/tours-privados/petropolis /es/tours-privados/petropolis-imperial
Redirect 301 /es/tours-privados/cielo-alto /es/tours-privados/bosque-tijuca
Redirect 301 /es/tours-privados/niteroi /es/tours-privados/niteroi-museo-mac
Redirect 301 /es/tours-privados/visiones-futuro /es/tours-privados/rio-moderno-museo-manana
Redirect 301 /es/tours-privados/caminata-historica /es/tours-privados/downtown-rio-walking

# [PT]
Redirect 301 /pt-br/passeios-privados/rio-inesquecivel /pt-br/passeios-privados/rio-essencial
Redirect 301 /pt-br/passeios-privados/rio-flash /pt-br/passeios-privados/passeio-expresso-rio-5-horas-cristo-pao-acucar
Redirect 301 /pt-br/passeios-privados/nascer-sol-pao-acucar /pt-br/passeios-privados/nascer-sol-pao-acucar-cristo-redentor-passeio-privado
Redirect 301 /pt-br/passeios-privados/magia-por-do-sol /pt-br/passeios-privados/passeio-por-do-sol-rio-cristo-redentor-pao-acucar
Redirect 301 /pt-br/passeios-privados/por-do-sol-roxy /pt-br/passeios-privados/por-do-sol-cultura-roxy
Redirect 301 /pt-br/passeios-privados/ilha-grande /pt-br/passeios-privados/island-escape-ilha-grande
Redirect 301 /pt-br/passeios-privados/buzios /pt-br/passeios-privados/buzios-charme-costeiro-passeio-privado
Redirect 301 /pt-br/passeios-privados/petropolis /pt-br/passeios-privados/passeio-privado-petropolis-cidade-imperial
Redirect 301 /pt-br/passeios-privados/alto-ceu /pt-br/passeios-privados/pao-acucar-floresta-tijuca-jardim-botanico-passeio
Redirect 301 /pt-br/passeios-privados/niteroi /pt-br/passeios-privados/niteroi-museo-arte-contemporanea-passeio-privado
Redirect 301 /pt-br/passeios-privados/visoes-futuro /pt-br/passeios-privados/museu-amanha-experiencia-carnaval-rio-passeio
Redirect 301 /pt-br/passeios-privados/caminhada-historica /pt-br/passeios-privados/downtown-rio-walking

# Blog & Institutional
Redirect 301 /rio-beyond-the-guidebook/ /en/blog
Redirect 301 /en/contato/ /en/contact
Redirect 301 /pt-br/contact /pt-br/contato
Redirect 301 /privacy-policy/ /en/privacy-policy

# Catch-all fixes
RedirectMatch 301 ^/en/tours-privados/(.*)$ /en/private-tours
RedirectMatch 301 ^/pt-br/tours-privados/(.*)$ /pt-br/passeios-privados

# --- 5) COMPRESSION ---
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css \
    text/javascript application/javascript application/json image/svg+xml font/woff2
</IfModule>

# --- 6) CACHING (FIXED & OPTIMIZED) ---
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType text/html "access plus 0 seconds"
</IfModule>

<IfModule mod_headers.c>
  # REMOVIDO o LocationMatch com noindex que causava erro no Google
  <FilesMatch "\.(js|css|jpg|jpeg|png|gif|webp|avif|svg|woff2)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>

  # Service Worker (Sempre buscar versão nova)
  <FilesMatch "^(sw\.js|service-worker\.js)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
  </FilesMatch>
</IfModule>

# --- 7) SECURITY HEADERS ---
<IfModule mod_headers.c>
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set X-Content-Type-Options "nosniff"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
  Header unset X-Powered-By
</IfModule>

# --- 8) PROTECT SENSITIVE FILES ---
<FilesMatch "\.(htaccess|htpasswd|env|git|gitignore)$">
  <IfModule mod_authz_core.c>
    Require all denied
  </IfModule>
</FilesMatch>

Options -Indexes
DirectoryIndex index.html
ErrorDocument 404 /404.html
