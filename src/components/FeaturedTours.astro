---



import TourCard from "./TourCard.astro";
import { tours } from "../data/tours.js";
import { useTranslations } from "../i18n/utils";

const { lang } = Astro.props;
const t = useTranslations(lang);


const featuredTours = tours[lang].filter((tour) => tour.isFeatured);


const howItWorks = {
  en: {
    title: "How It Works",
    steps: [
      {
        number: "1",
        title: "Tell us your vibe",
        description: "Share your interests and preferences",
        icon: "chat"
      },
      {
        number: "2", 
        title: "We design your plan",
        description: "We craft your perfect Rio itinerary",
        icon: "map"
      },
      {
        number: "3",
        title: "You enjoy Rio",
        description: "We handle everything (guides, tickets, pickup)",
        icon: "pin"
      }
    ]
  },
  es: {
    title: "Cómo Funciona",
    steps: [
      {
        number: "1",
        title: "Cuéntanos tu estilo",
        description: "Comparte tus intereses y preferencias",
        icon: "chat"
      },
      {
        number: "2",
        title: "Diseñamos tu plan",
        description: "Creamos tu itinerario perfecto en Río",
        icon: "map"
      },
      {
        number: "3",
        title: "Disfruta Río",
        description: "Nosotros manejamos todo (guías, tickets, pickup)",
        icon: "pin"
      }
    ]
  },
  "pt-br": {
    title: "Como Funciona",
    steps: [
      {
        number: "1",
        title: "Conte seu estilo",
        description: "Compartilhe seus interesses e preferências",
        icon: "chat"
      },
      {
        number: "2",
        title: "Planejamos seu roteiro",
        description: "Criamos seu itinerário perfeito no Rio",
        icon: "map"
      },
      {
        number: "3",
        title: "Aproveite o Rio",
        description: "Cuidamos de tudo (guias, ingressos, busca)",
        icon: "pin"
      }
    ]
  }
};

const content = howItWorks[lang] || howItWorks.en;


const tourBadgeMap = {
  "unforgettable-rio": {
    en: "Most Popular",
    es: "Más Popular",
    "pt-br": "Mais Popular"
  },
  "sunset-magic": {
    en: "Best for Sunset",
    es: "Mejor para Atardecer",
    "pt-br": "Melhor para Pôr do Sol"
  },
  "custom-tour": {
    en: "Fully Customizable",
    es: "Totalmente Personalizable",
    "pt-br": "Totalmente Personalizável"
  },
  "petropolis": {
    en: "Best Value",
    es: "Mejor Valor",
    "pt-br": "Melhor Custo-Benefício"
  }
};
---


<section class="how-it-works">
  <div class="container">
    <h2 class="section-title-decorated">{content.title}</h2>
    
    <div class="steps-grid">
      {content.steps.map((step, index) => (
        <div class="step-card glass-light">
          <div class="step-number">{step.number}</div>
          <div class="step-content">
            <h3 class="step-title">{step.title}</h3>
            <p class="step-description">{step.description}</p>
          </div>
          <div class="step-icon">
            {step.icon === "chat" && (
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M21 11.5a8.38 8.38 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.38 8.38 0 01-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.38 8.38 0 013.8-.9h.5a8.48 8.48 0 018 8v.5z"/>
              </svg>
            )}
            {step.icon === "map" && (
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M1 6v16l7-4 8 4 7-4V2l-7 4-8-4-7 4z"/>
                <path d="M8 2v16M16 6v16"/>
              </svg>
            )}
            {step.icon === "pin" && (
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
                <circle cx="12" cy="10" r="3"/>
              </svg>
            )}
          </div>
          {index < content.steps.length - 1 && (
            <div class="step-connector">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
            </div>
          )}
        </div>
      ))}
    </div>
  </div>
</section>


<section class="featured-tours">
  <div class="container">
    <h2 class="section-title-decorated">{t("featuredTours.title")}</h2>
    <p class="section-subtitle">{t("featuredTours.subtitle")}</p>

    <div class="tours-grid grid grid-3">
      {featuredTours.map((tour) => (
        <TourCard
          tour={tour}
          lang={lang}
          badge={tourBadgeMap[tour.id]?.[lang]}
        />
      ))}
    </div>

    <div class="section-cta">
      <a
        href={`/${lang}/${lang === "en" ? "private-tours" : lang === "es" ? "tours-privados" : "passeios-privados"}`}
        class="btn btn-outline-primary btn-lg"
      >
        {t("featuredTours.viewAll")}
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </a>
    </div>
  </div>
</section>

<style>
  
  .how-it-works {
    --step-grid-min: 280px;
    --step-card-lift: -4px;
    --step-number-size: clamp(3rem, 6vw, 3.5rem);
    --step-number-border: var(--border-width-strong);
    --step-connector-offset: -32px;
    --step-icon-size: clamp(2rem, 4vw, 2.25rem);
    --section-subtitle-max: clamp(40rem, 75vw, 50rem);
    --cta-btn-gap: var(--space-xs);

    padding: var(--space-3xl) 0;
    background-color: var(--color-bg-soft);
  }

  .steps-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(100%, var(--step-grid-min)), 1fr));
    gap: var(--space-lg);
    margin-top: var(--space-2xl);
  }

  .step-card {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: var(--space-xl);
    border-radius: var(--radius-lg);
    transition: transform var(--transition-duration-slow) var(--transition-easing-default);
  }

  .step-card:hover {
    transform: translateY(var(--step-card-lift));
  }

  .step-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: var(--step-number-size);
    height: var(--step-number-size);
    border: var(--step-number-border) solid var(--color-border);
    border-radius: 50%;
    font-size: var(--font-size-h4);
    font-weight: var(--font-weight-bold);
    color: var(--color-text);
    margin-bottom: var(--space-md);
  }

  .step-content {
    flex-grow: 1;
  }

  .step-title {
    font-size: var(--font-size-h5);
    font-weight: var(--font-weight-bold);
    color: var(--color-text);
    margin-bottom: var(--space-sm);
  }

  .step-description {
    font-size: var(--font-size-small);
    color: var(--color-text-light);
    line-height: var(--line-height-relaxed);
  }

  .step-icon {
    margin-top: var(--space-lg);
    color: var(--color-secondary);
    opacity: 0.6;
  }

  .step-connector {
    display: none;
    position: absolute;
    right: var(--step-connector-offset);
    top: 50%;
    transform: translateY(-50%);
    color: var(--color-border);
  }

  @media (min-width: 900px) {
    .step-connector {
      display: block;
    }
  }

  
  .featured-tours {
    padding: var(--space-3xl) 0;
    background-color: var(--color-bg-soft);
  }

  .section-subtitle {
    text-align: center;
    font-size: var(--font-size-h5);
    color: var(--color-text-light);
    line-height: var(--line-height-relaxed);
    max-width: var(--section-subtitle-max);
    margin: var(--space-md) auto var(--space-2xl);
  }

  .tours-grid {
    margin-bottom: var(--space-2xl);
  }

  .section-cta {
    text-align: center;
  }

  .section-cta .btn {
    display: inline-flex;
    align-items: center;
    gap: var(--cta-btn-gap);
  }

  .featured-tours .section-cta .btn-outline-primary {
    border-color: transparent;
  }

  .featured-tours .section-cta .btn-outline-primary:focus,
  .featured-tours .section-cta .btn-outline-primary:focus-visible {
    outline: none;
    box-shadow: none;
  }

  
  @media (max-width: 768px) {
    .how-it-works,
    .featured-tours {
      padding: var(--space-2xl) 0;
    }

    .section-title-decorated {
      text-align: center;
    }

    .steps-grid {
      margin-top: var(--space-lg);
      gap: var(--space-md);
    }

    .step-card {
      padding: var(--space-md);
      text-align: center;
      align-items: center;
    }

    .step-number {
      margin-bottom: var(--space-sm);
    }

    .step-title {
      font-size: var(--font-size-body);
    }

    .step-description {
      font-size: var(--font-size-small);
    }

    .step-icon {
      margin-top: var(--space-md);
    }

    .step-icon svg {
      width: var(--step-icon-size);
      height: var(--step-icon-size);
    }

    .section-subtitle {
      margin-bottom: var(--space-xl);
      font-size: var(--font-size-body);
      padding-inline: var(--space-md);
    }

    .tours-grid {
      margin-bottom: var(--space-xl);
    }
  }
</style>
