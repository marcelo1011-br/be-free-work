---
/* ================================
   BE FREE TOURS - Sitemap XML
   Gera sitemap automaticamente
   ================================ */

import { tours } from "../data/tours.js";
import { getCollection } from "astro:content";

// Site base URL
const siteUrl = Astro.site?.toString() || "https://befreetours.com.br";

// Páginas estáticas por idioma
const staticPagesByLang = {
  en: [
    { path: "", priority: 1.0 },
    { path: "/private-tours", priority: 0.9 },
    { path: "/gallery", priority: 0.7 },
    { path: "/about", priority: 0.7 },
    { path: "/contact", priority: 0.7 },
    { path: "/blog", priority: 0.8 },
    { path: "/blog/christ-redeemer", priority: 0.8 },
    { path: "/blog/rio-beaches", priority: 0.8 },
    { path: "/blog/rio-food", priority: 0.8 },
  ],
  es: [
    { path: "", priority: 1.0 },
    { path: "/tours-privados", priority: 0.9 },
    { path: "/galeria", priority: 0.7 },
    { path: "/sobre", priority: 0.7 },
    { path: "/contato", priority: 0.7 },
    { path: "/blog", priority: 0.8 },
    { path: "/blog/cristo-redentor", priority: 0.8 },
    { path: "/blog/playas-de-rio", priority: 0.8 },
    { path: "/blog/comida-en-rio", priority: 0.8 },
  ],
  "pt-br": [
    { path: "", priority: 1.0 },
    { path: "/passeios-privados", priority: 0.9 },
    { path: "/galeria", priority: 0.7 },
    { path: "/sobre", priority: 0.7 },
    { path: "/contato", priority: 0.7 },
    { path: "/blog", priority: 0.8 },
    { path: "/blog/cristo-redentor", priority: 0.8 },
    { path: "/blog/praias-do-rio", priority: 0.8 },
    { path: "/blog/comida-no-rio", priority: 0.8 },
  ],
};

const languages = Object.keys(staticPagesByLang);

// Gera URLs para páginas estáticas por idioma
const staticUrls = languages.flatMap((lang) =>
  staticPagesByLang[lang].map((page) => ({
    loc: `${siteUrl}/${lang}${page.path}`,
    lastmod: new Date().toISOString().split("T")[0],
    changefreq: page.path === "" ? "weekly" : "monthly",
    priority: page.priority,
  }))
);

// Gera URLs para tours individuais
const tourUrls = [];
for (const [lang, tourList] of Object.entries(tours)) {
  const langPath =
    lang === "en"
      ? "private-tours"
      : lang === "es"
        ? "tours-privados"
        : "passeios-privados";

  for (const tour of tourList) {
    tourUrls.push({
      loc: `${siteUrl}/${lang}/${langPath}/${tour.slug}`,
      lastmod: new Date().toISOString().split("T")[0],
      changefreq: "monthly",
      priority: 0.85,
    });
  }
}

// URLs para posts do blog
const allPosts = await getCollection("blog");
const blogUrls = allPosts.map((post) => {
  const [lang, slug] = post.slug.split("/");
  const lastmod = post.data.updateDate || post.data.publishDate;
  return {
    loc: `${siteUrl}/${lang}/blog/${slug}`,
    lastmod,
    changefreq: "monthly",
    priority: 0.7,
  };
});

// Combina todas as URLs
const allUrls = [...staticUrls, ...tourUrls, ...blogUrls];

// Remove Astro.response - não é mais necessário no Astro 4+
---

<!--?xml version="1.0" encoding="UTF-8"?-->
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  {
    allUrls.map((url) => (
      <url>
        <loc>{url.loc}</loc>
        <lastmod>{url.lastmod}</lastmod>
        <changefreq>{url.changefreq}</changefreq>
        <priority>{url.priority}</priority>
      </url>
    ))
  }
</urlset>
